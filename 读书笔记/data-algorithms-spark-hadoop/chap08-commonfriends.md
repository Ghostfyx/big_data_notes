# chap08 共同好友

给定一个包含上千万用户的社交网络，这一章我们会实现一个MapReduce&Spark程序，在所有用户中寻找共同好友。令 $U$为包含所有用户的一个集合：$\{U_1,U_2, \dots, U_n\}$，我们的目标是为每个$\{U_i,U_j\}$对寻找共同好友。

本章提供三种解决方案：

- MapReduce/Hadoop+基本数据类型
- MapReduce/Hadoop+定制数据类型
- Spark

## 共同好友实现思路

令$[P_i,F_1,F_2,\dots,F_j]$表示输入的$P_i$的好友数据。

- 映射阶段，将输入表示为：$[(P_i,F_k),[F_1,F_2, \dots, F_j]], k \in j$的形式，表示用户$P_i$与$F_k$是好友的情况下，$P_i$的好友；为了防止映射阶段输出键出现$(P_i,F_k)$与$(F_k,P_i)$这样的重复，将组合键排序。
- 归约阶段：合并Key相同的数据，即$P_i$与$F_k$是好友的情况下，$P_i$和$F_k$的好友数据，寻找两者好友的交集即可。

## 代码实现

见data-algorithms-spark-hadoop项目下的Chap08子模块。

