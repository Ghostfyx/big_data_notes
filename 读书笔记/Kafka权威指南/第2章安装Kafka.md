# 第二章 安装Kafka

## 2.3 broker配置

Kafka 发行包里自带的配置样本可以用来安装单机服务，但并不能满足大多数安装场景的 要求。Kafka 有很多配置选项，涉及安装和调优的方方面面。不过大多数调优选项可以使 用默认配置，除非你对调优有特别的要求。

### 2.3.1 常规配置

有一些配置选项，在单机安装时可以直接使用默认值，但在部署到其他环境时要格外小 心。这些参数是单个服务器最基本的配置，它们中的大部分需要经过修改后才能用在集群里。

**1. broker.Id**

每个 broker 都需要有一个标识符，使用 broker.id 来表示。它的默认值是0，也可以被设置成其他任意**整数**。这个值在整个 Kafka 集群里必须是唯一的。这个值可以任意选定，如果 出于维护的需要，可以在服务器节点间交换使用这些 ID。建议把它们设置成与机器名具有 相关性的整数，这样在进行维护时，将 ID 号映射到机器名就没那么麻烦了。例如，如果 机器名包含唯一性的数字(比如 host1.example.com、host2.example.com)，那么用这些数字来设置 broker.id 就再好不过了。

**2. port**

如果使用配置样本来启动Kafka，它会监听**9092端口**。修改port配置参数可以把它设置成其他任意可用的端口。要注意，如果使用1024以下的端口，需要使用root权限启动Kafka，不过不建议这么做。

**3. zookeeper.connect**

用于保存broker元数据的Zookeeper地址是通过zookeeper.connect来指定的。 `localhost:2181`表示这个 Zookeeper是运行在本地的218 端口上。该配置参数是用冒号分隔的一组 hostname:port/path 列表，每一部分的含义如下:

- hostname 是 Zookeeper 服务器的机器名或 IP 地址;
- port是客户端的连接端口
- /path是可选的Zookeeper路径，作为Kafka集群的chroot环境。如果不指定，默认使用根路径。如果指定的chroot路径不存在，broker会在启动的时候创建它。

------

**为什么使用 chroot 路径**

在 Kafka 集群里使用 chroot路径(zookeeper客户端命名空间)是一种最佳实践。Zookeeper 群组可以共享 给其他应用程序，即使还有其他 Kafka 集群存在，也不会产生冲突。最好是 在配置文件里指定一组 Zookeeper 服务器，用分号把它们隔开。一旦有一个 Zookeeper 服务器宕机，broker 可以连接到 Zookeeper 群组的另一个节点上。

------

**4. log.dirs**

Kafka 把所有消息都保存在磁盘上，存放这些日志片段的目录是通过 log.dirs 指定的。它是 一组用逗号分隔的本地文件系统路径。如果指定了多个路径，那么 broker 会根据“最少使 用”原则，把同一个分区的日志片段保存到同一个路径下。要注意，broker 会往拥有最少数目分区的路径新增分区，而不是往拥有最小磁盘空间的路径新增分区。